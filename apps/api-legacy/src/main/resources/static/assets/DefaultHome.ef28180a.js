import{d as f,f as F,a as we,Q as Ye}from"./format-util.3d0400b0.js";import{bC as Be,W as E,ai as Ee,bD as Me,a7 as re,bE as xe,bF as Se,k as A,aA as qe,aE as Oe,aG as r,X as w,ba as s,a5 as u,_ as c,bG as Re,bH as ae,Y as B,bI as ne,bJ as k,F as m,a4 as y,bK as Qe,y as q,Z as v,aM as H,B as oe,D as Ie,K as V,bL as z,bM as Le,bN as $e,aJ as Te,aH as Fe}from"./index.cff9ac5d.js";import{Q as ze}from"./QInnerLoading.5c1f95a1.js";import{Q as Pe,a as je}from"./QTable.5ee997c8.js";import{Q}from"./QTd.b726fe35.js";import{Q as Ne,p as P,i as He,d as se}from"./index.esm.88941453.js";import{c as Ve}from"./table-util.866aca54.js";import{g as Ge}from"./reservation.44c609ae.js";import{f as Ke}from"./reservation.fe42a8fb.js";import"./_commonjsHelpers.2cf1d77b.js";import"./QVirtualScroll.7365e47a.js";import"./QSelect.fa044258.js";import"./base.359dd365.js";var Ue=Be({name:"QTr",props:{props:Object,noHover:Boolean},setup(h,{slots:M}){const p=E(()=>"q-tr"+(h.props===void 0||h.props.header===!0?"":" "+h.props.__trClass)+(h.noHover===!0?" q-tr--no-hover":""));return()=>Ee("tr",{class:p.value},Me(M.default))}});function We(h,M){for(let p=0;p<h.length;p++)if(M(h[p],p)===!0)return p;return-1}const ue=h=>(Te("data-v-56bd2ea9"),h=h(),Fe(),h),Je={class:"row items-center justify-between"},Xe={class:"row items-center"},Ze=ue(()=>c("div",null,"\uC785\uC2E4 \uC815\uBCF4 \uC694\uC57D",-1)),et={class:"row q-mb-md justify-between items-center"},tt={class:"text-h6"},at={class:"row q-mb-md justify-between items-center"},nt={class:"text-caption text-grey"},ot={class:"row"},st={class:"col q-pa-md-sm"},rt={key:0},ut={key:1},lt={key:2},it={class:"row q-pt-sm"},ct={class:"col q-pa-md-sm"},dt={style:{"min-height":"500px"}},ft={class:"row justify-between items-center q-pa-sm full-width"},mt={class:"row items-center"},vt={class:"text-h6"},ht={class:"row q-gutter-sm"},yt={key:0},pt={key:0},Ct={key:1},_t={key:1,class:"text-grey"},gt={key:0},bt={key:1},Dt=ue(()=>c("div",{class:"full-width row justify-center q-py-md"},[c("div",{class:"text-grey text-body1"},"\uC774 \uB0A0\uC9DC\uC5D0 \uB4F1\uB85D\uB41C \uC608\uC57D\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.")],-1)),At=re({__name:"ReservationSummary",setup(h){const M=xe(),p=Se(),Y=A({isLoading:!1,isLoaded:!1,isPatching:!1}),_=A({sort:"stayStartAt",stayStartAt:f().startOf("month").format("YYYY-MM-DD"),stayEndAt:f().endOf("month").format("YYYY-MM-DD")}),le=[{name:"type",field:"type",label:"\uAD6C\uBD84",align:"left",required:!0,sortable:!0},{...$("name"),align:"left",required:!0,sortable:!0},{name:"peopleCount",field:"peopleCount",label:"\uC778\uC6D0\uC218",align:"center",required:!0,sortable:!0},{name:"missPrice",field:"missPrice",label:"\uBBF8\uC218\uAE08",align:"left",required:!0},{...$("paymentMethod"),align:"left",required:!0,sortable:!0},{...$("rooms"),align:"left",required:!0,sortable:!0},{...$("note"),align:"left",headerStyle:"width: 10%"}],O=A(),d=A(F()),C=A(f()),I=A({}),G=A("\uB85C\uB529 \uC911..."),x=A(null),ie=A(5*60*1e3),K=E(()=>I.value[d.value]||[]),ce=E(()=>{const t=[];return Object.entries(I.value).forEach(([n,e])=>{e.forEach(a=>{a.stayStartAt===n&&t.push({id:a.id,name:a.name,peopleCount:a.peopleCount,rooms:a.rooms.map(o=>o.number),start:a.stayStartAt,end:a.stayEndAt,bgcolor:_e(a),details:`${a.name} - ${a.stayStartAt} ~ ${a.stayEndAt}`})})}),t}),de=E(()=>C.value.format("YYYY\uB144 M\uC6D4")),fe=E(()=>C.value.year()),me=E(()=>C.value.month()+1),L=E(()=>{const t={},n=f(_.value.stayStartAt),e=f(_.value.stayEndAt);let a=n;for(;a.isBefore(e)||a.isSame(e,"day");){const o=a.format("YYYY-MM-DD");t[o]={checkIn:0,checkOut:0},a=a.add(1,"day")}return Object.entries(I.value).forEach(([o,i])=>{t[o]||(t[o]={checkIn:0,checkOut:0}),i.forEach(l=>{l.stayStartAt===o?t[o].checkIn++:l.stayEndAt===o&&t[o].checkOut++})}),t});function $(t){return Ve(Ge(t))}function S(){Y.value.isLoading=!0,Y.value.isLoaded=!1,Ke({stayStartAt:_.value.stayStartAt,stayEndAt:_.value.stayEndAt,status:"NORMAL",type:"STAY",size:200}).then(t=>{I.value=ve(t.values),Y.value.isLoaded=!0,G.value=f().format("YYYY-MM-DD HH:mm:ss")}).finally(()=>{Y.value.isLoading=!1})}function ve(t){const n={};return t.forEach(e=>{e.missPrice=e.price-e.paymentAmount;for(const[a,o]of he(e.stayStartAt,e.stayEndAt).entries()){Object.keys(n).includes(o)||(n[o]=[]);const i={...e,type:"N/A"};a===0?i.type="\uC785\uC2E4":o===e.stayEndAt?i.type="\uD1F4\uC2E4":i.type="\uC5F0\uBC15",n[o].push(i)}}),n}function he(t,n){const e=F(t),a=F(n),o=[];for(let i=e;i<=a;i=f(i).add(1,"day").format("YYYY-MM-DD"))o.push(i);return o}function j(t){const n=t.startOf("month"),e=t.endOf("month");let a=0;const o=n.day();o===0?a=6:o!==1&&(a=o-1);const i=n.subtract(a,"day"),l=e.day()===0?0:7-e.day(),g=e.add(l,"day");return{startAt:i.format("YYYY-MM-DD"),endAt:g.format("YYYY-MM-DD")}}function ye(t){const n=t.year,e=t.month;C.value=f(`${n}-${e}-01`);const a=j(C.value);_.value.stayStartAt=a.startAt,_.value.stayEndAt=a.endAt,d.value=C.value.startOf("month").format("YYYY-MM-DD"),S()}function pe(t){d.value=t;const n=f(t);if(n.month()!==C.value.month()||n.year()!==C.value.year()){C.value=n;const e=j(C.value);_.value.stayStartAt=e.startAt,_.value.stayEndAt=e.endAt,S()}}function Ce(t){return t.paymentMethod.requireUnpaidAmountCheck===!1?"":t.missPrice>0?"bg-warning":""}const T=["purple","deep-purple","indigo","blue","light-blue","cyan","teal","green","light-green","lime","yellow","amber","orange","deep-orange","brown","blue-grey","pink","red"],N=new Map;let U=0;function _e(t){if(!t.rooms||t.rooms.length===0)return"grey-7";const n=t.rooms[0].roomGroup.id;return N.has(n)?T[N.get(n)]:(N.set(n,U%T.length),T[U++%T.length])}function ge(t){switch(t){case"\uC785\uC2E4":return"positive";case"\uD1F4\uC2E4":return"negative";case"\uC5F0\uBC15":return"info";default:return"grey"}}function W(){var n;const t=f(d.value).subtract(1,"day").format("YYYY-MM-DD");f(t).month()!==f(d.value).month()&&((n=O.value)==null||n.prev()),d.value=t}function J(){var n;const t=f(d.value).add(1,"day").format("YYYY-MM-DD");f(t).month()!==f(d.value).month()&&((n=O.value)==null||n.next()),d.value=t}function be(t){var i;if(!t||t.length===0)return[];const n=P(`${t[0].date} 00:00`),e=P(`${(i=t[t.length-1])==null?void 0:i.date} 23:59`);if(!n||!e)return[];const a=ce.value.map((l,g)=>{const b=P(`${l.start} 00:00`),D=P(`${l.end} 23:59`);if(b&&D&&He(b,D,n,e)){const R=se(n,b),te=se(D,e);return{id:g,left:R,right:te,size:t.length-(R+te),event:l}}return null}).filter(Boolean),o=[];if(a.length>0){const l=a.sort((g,b)=>{var D,R;return((D=g.left)!=null?D:0)-((R=b.left)!=null?R:0)});l.forEach((g,b)=>{X(o,t.length,l,b,0,0)})}return o}function X(t,n,e,a,o,i){const l=e[a];if(l!==void 0&&"left"in l&&l.left>=o){l.left-o&&t.push({size:l.left-o}),t.push({size:l.size,event:l.event}),i!==0&&e.splice(a,1);const g=l.left+l.size;if(g<=n){const b=We(e,D=>D.id!==l.id&&D.left!==void 0&&D.left>=g);X(t,n,e,b!==-1?b:a,g,i+1)}}else t.push({size:n-o})}function De(t){return t.event!==void 0?{"my-event":!0,"text-white":!0,[`bg-${t.event.bgcolor}`]:!0,[`text-${t.event.bgcolor}`]:!1,"rounded-border":!0}:{"my-void-event":!0}}function Ae(t,n){const e={};return t.size!==void 0&&(e.width=100/n*t.size+"%"),e}function Z(){document.visibilityState==="visible"&&S()}function ee(t){t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||(t.key==="ArrowLeft"?W():t.key==="ArrowRight"&&J())}function ke(){x.value!==null&&clearInterval(x.value),x.value=window.setInterval(()=>{S()},ie.value)}return qe(()=>{const t=j(C.value);_.value.stayStartAt=t.startAt,_.value.stayEndAt=t.endAt,document.addEventListener("visibilitychange",Z),document.addEventListener("keydown",ee),S(),ke()}),Oe(()=>{document.removeEventListener("visibilitychange",Z),document.removeEventListener("keydown",ee),x.value!==null&&(clearInterval(x.value),x.value=null)}),(t,n)=>(r(),w(Le,{flat:"",bordered:""},{default:s(()=>[u(ne,{class:"text-h6 bg-primary text-white"},{default:s(()=>[c("div",Je,[c("div",Xe,[u(Re,{name:"hotel",size:"md",class:"q-mr-sm"}),Ze]),Y.value.isLoading?(r(),w(ae,{key:0,color:"white",size:"1.5em"})):B("",!0)])]),_:1}),u(ne,null,{default:s(()=>[u(ze,{showing:Y.value.isLoading},{default:s(()=>[u(ae,{size:"50px",color:"primary"})]),_:1},8,["showing"]),c("div",et,[u(k,{icon:"chevron_left",color:"primary",flat:"",round:"",dense:"",onClick:n[0]||(n[0]=e=>{var a;return(a=O.value)==null?void 0:a.prev()})}),c("div",tt,m(de.value),1),u(k,{icon:"chevron_right",color:"primary",flat:"",round:"",dense:"",onClick:n[1]||(n[1]=e=>{var a;return(a=O.value)==null?void 0:a.next()})})]),c("div",at,[c("div",nt,[y(" \uB9C8\uC9C0\uB9C9 \uAC31\uC2E0: "+m(G.value)+" ",1),u(Qe,null,{default:s(()=>[y("\uD398\uC774\uC9C0 \uD3EC\uCEE4\uC2A4 \uBCF5\uADC0 \uC2DC \uC790\uB3D9 \uAC31\uC2E0\uB429\uB2C8\uB2E4.")]),_:1})]),u(k,{icon:"refresh",color:"primary",flat:"",dense:"",loading:Y.value.isLoading,onClick:n[2]||(n[2]=e=>S()),label:"\uC0C8\uB85C\uACE0\uCE68"},null,8,["loading"])]),c("div",ot,[c("div",st,[u(q(Ne),{ref_key:"calendar",ref:O,modelValue:d.value,"onUpdate:modelValue":[n[3]||(n[3]=e=>d.value=e),pe],onNavigation:ye,year:fe.value,month:me.value,hoverable:!0,focusable:!1,"focus-type":["day","date"],now:q(F),mask:"YYYY-MM-DD",locale:"ko-KR",weekdays:[1,2,3,4,5,6,0],"day-min-height":"150","day-height":0,animated:"",bordered:""},{week:s(({scope:{week:e}})=>[(r(!0),v(V,null,H(be(e),(a,o)=>(r(),v("div",{key:o,class:oe(De(a)),style:Ie(Ae(a,e.length))},[a.event&&a.event.name?(r(),w(k,{key:0,to:{name:"Reservation",params:{id:a.event.id}},class:"full-width full-height q-pa-none block",size:"sm",dense:"",flat:""},{default:s(()=>[y(m(a.event.name)+"\uB2D8\xA0 ",1),a.event.peopleCount>1?(r(),v("span",rt," \uC678 "+m(a.event.peopleCount-1)+"\uBA85 ",1)):B("",!0),y("\xA0 "),a.event.rooms.length>0?(r(),v("span",ut," ("+m(a.event.rooms.join(", "))+") ",1)):(r(),v("span",lt,"(\uBBF8\uBC30\uC815)"))]),_:2},1032,["to"])):B("",!0)],6))),128))]),_:1},8,["modelValue","year","month","now"])])]),c("div",it,[c("div",ct,[c("div",dt,[u(Pe,{columns:le,rows:K.value,"row-key":"id",flat:"",bordered:"",pagination:{rowsPerPage:20,sortBy:"type",descending:!1}},{top:s(()=>{var e,a;return[c("div",ft,[c("div",mt,[u(k,{icon:"chevron_left",color:"primary",flat:"",round:"",dense:"",onClick:n[4]||(n[4]=o=>W())}),c("div",vt,m(d.value)+" \uC608\uC57D \uD604\uD669",1),u(k,{icon:"chevron_right",color:"primary",flat:"",round:"",dense:"",onClick:n[5]||(n[5]=o=>J())})]),c("div",ht,[((e=L.value[d.value])==null?void 0:e.checkIn)>0?(r(),w(z,{key:0,color:"positive",class:"q-px-sm"},{default:s(()=>{var o;return[y(" \uC785\uC2E4 "+m((o=L.value[d.value])==null?void 0:o.checkIn),1)]}),_:1})):B("",!0),((a=L.value[d.value])==null?void 0:a.checkOut)>0?(r(),w(z,{key:1,color:"negative",class:"q-px-sm"},{default:s(()=>{var o;return[y(" \uD1F4\uC2E4 "+m((o=L.value[d.value])==null?void 0:o.checkOut),1)]}),_:1})):B("",!0),K.value.length?B("",!0):(r(),w(z,{key:2,color:"grey",class:"q-px-sm"},{default:s(()=>[y(" \uC608\uC57D \uC5C6\uC74C")]),_:1}))])])]}),header:s(e=>[u(Ue,{props:e},{default:s(()=>[(r(!0),v(V,null,H(e.cols,a=>(r(),w(je,{key:a.name,props:e,class:"bg-blue-1"},{default:s(()=>[y(m(a.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-type":s(e=>[u(Q,{key:"type",props:e},{default:s(()=>[u(z,{color:ge(e.row.type),"text-color":"white",class:"q-px-sm"},{default:s(()=>[y(m(e.row.type),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-rooms":s(e=>[u(Q,{key:"rooms",props:e},{default:s(()=>[e.row.rooms.length!==0?(r(),v("div",yt,[(r(!0),v(V,null,H(e.row.rooms,a=>(r(),v("span",{key:a.id},[q(p).isAdminRole?(r(),v("div",pt,[u(k,{to:{name:"Room",params:{id:a.id}},align:"left",color:"primary",dense:"",flat:""},{default:s(()=>[y(m(a.number),1)]),_:2},1032,["to"])])):(r(),v("div",Ct,m(a.number),1))]))),128))])):(r(),v("div",_t,"\uBBF8\uBC30\uC815"))]),_:2},1032,["props"])]),"body-cell-name":s(e=>[u(Q,{key:"name",props:e},{default:s(()=>[q(p).isAdminRole?(r(),v("div",gt,[u(k,{to:{name:"Reservation",params:{id:e.row.id}},class:"full-width",align:"left",color:"primary",dense:"",flat:""},{default:s(()=>[y(m(e.row.name),1)]),_:2},1032,["to"])])):(r(),v("div",bt,m(e.row.name),1))]),_:2},1032,["props"])]),"body-cell-missPrice":s(e=>[u(Q,{props:e,key:"missPrice",class:oe(Ce(e.row))},{default:s(()=>[y(m(q(we)(e.row.missPrice)),1)]),_:2},1032,["props","class"])]),"body-cell-note":s(e=>[u(Q,{props:e,key:"note"},{default:s(()=>[e.row.note?(r(),w(k,{key:0,onClick:a=>q(M).dialog({title:`${e.row.name}\uB2D8 \uC608\uC57D \uBA54\uBAA8`,message:e.row.note}),color:"primary"},{default:s(()=>[y(" \uBA54\uBAA8 \uD655\uC778 ")]),_:2},1032,["onClick"])):B("",!0)]),_:2},1032,["props"])]),"no-data":s(()=>[Dt]),_:1},8,["rows"])])])])]),_:1})]),_:1}))}});var kt=$e(At,[["__scopeId","data-v-56bd2ea9"]]);const $t=re({__name:"DefaultHome",setup(h){return(M,p)=>(r(),w(Ye,{padding:"",class:"q-pa-sm"},{default:s(()=>[u(kt)]),_:1}))}});export{$t as default};
