apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# 프로덕션 환경 설정
namespace: bsn-resort-management-system-production

# 기본 구성 상속
resources:
  - ../../base

# 환경별 라벨 추가
commonLabels:
  environment: production
  app.kubernetes.io/instance: production

# 프로덕션용 이미지 태그 설정 (CI/CD에서 업데이트)
images:
  - name: api-core
    newName: registry.gitlab.bellsoft.net/bell/resort-management-system/api-core
    newTag: main-latest  # CI/CD에서 main-{commit-sha} 형태로 업데이트
  - name: api-legacy
    newName: registry.gitlab.bellsoft.net/bell/resort-management-system/api-legacy
    newTag: main-latest  # CI/CD에서 main-{commit-sha} 형태로 업데이트
  - name: frontend-web
    newName: registry.gitlab.bellsoft.net/bell/resort-management-system/frontend-web
    newTag: main-latest  # CI/CD에서 main-{commit-sha} 형태로 업데이트

# 프로덕션 환경별 ConfigMap 재정의
configMapGenerator:
  - name: resort-common-config
    behavior: replace
    literals:
      - TZ=Asia/Seoul
      - LANG=ko_KR.UTF-8
      - LC_ALL=ko_KR.UTF-8
  - name: api-core-config
    behavior: merge
    literals:
      - API_PROFILE=production
      - LOG_LEVEL=info
      - LOG_FORMAT=json
      - SECURITY_RATE_LIMIT_ENABLED=true
      - SECURITY_RATE_LIMIT_RPS=50
      - SECURITY_RATE_LIMIT_BURST=100
      - CORS_ALLOWED_ORIGINS=https://resort.bellsoft.net
      - GRACEFUL_SHUTDOWN_TIMEOUT=30s

# 프로덕션용 네임스페이스 패치
patchesStrategicMerge:
  - namespace-patch.yaml
  - production-values.yaml

# 프로덕션용 리소스 스케일링
replicas:
  - name: api-core
    count: 3
  - name: api-legacy
    count: 2
  - name: frontend-web
    count: 3

# 프로덕션용 Secret 재정의 (실제 값은 외부 Secret Manager에서 주입)
secretGenerator:
  - name: resort-secrets
    behavior: replace
    literals:
      - JWT_SECRET=REPLACE_WITH_ACTUAL_SECRET
      - DATABASE_MYSQL_HOST=REPLACE_WITH_ACTUAL_HOST
      - DATABASE_MYSQL_USER=REPLACE_WITH_ACTUAL_USER
      - DATABASE_MYSQL_PASSWORD=REPLACE_WITH_ACTUAL_PASSWORD
      - REDIS_HOST=REPLACE_WITH_ACTUAL_REDIS_HOST
      - REDIS_PASSWORD=REPLACE_WITH_ACTUAL_REDIS_PASSWORD